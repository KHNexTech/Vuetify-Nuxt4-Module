# i18n Integration Guide

Complete guide for integrating Vuetify with `@nuxtjs/i18n` for internationalization support.

---

## Table of Contents

- [Overview](#overview)
- [Installation](#installation)
- [Configuration](#configuration)
- [Locale Files](#locale-files)
- [Usage](#usage)
- [RTL Support](#rtl-support)
- [Advanced Configuration](#advanced-configuration)
- [Troubleshooting](#troubleshooting)

---

## Overview

Vuetify Nuxt 4 Module provides seamless integration with `@nuxtjs/i18n`. When both modules are installed, the Vuetify locale adapter automatically connects to vue-i18n, enabling:

- Synchronized locale switching
- Vuetify component translations
- RTL (Right-to-Left) support
- Fallback locale handling

---

## Installation

### Install Dependencies

```bash
npm install @nuxtjs/i18n vue-i18n
```

### Module Order

**Important:** `@nuxtjs/i18n` must be listed **before** `vuetify-nuxt4-module`:

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: [
    '@nuxtjs/i18n',        // First
    'vuetify-nuxt4-module', // Second
  ],
})
```

---

## Configuration

### Basic Setup

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: [
    '@nuxtjs/i18n',
    'vuetify-nuxt4-module',
  ],

  i18n: {
    locales: [
      { code: 'en', file: 'en.js', name: 'English' },
      { code: 'km', file: 'km.json', name: 'ខ្មែរ' },
      { code: 'zh', file: 'zh.json', name: '中文' },
    ],
    defaultLocale: 'en',
    langDir: 'locales/',
    strategy: 'prefix_except_default',
  },

  vuetify: {
    i18n: true,  // Enable vue-i18n adapter (default)
  },
})
```

### i18n Options

```typescript
vuetify: {
  i18n: true,  // Boolean: enable/disable
  
  // Or object form
  i18n: {
    useVueI18nAdapter: true,  // Use vue-i18n adapter
  }
}
```

---

## Locale Files

### Structure

Create locale files in your `locales/` directory:

```
locales/
├── en.json
├── km.json
├── zh.json
└── ar.json
```

### File Format

Vuetify translations must be under the `$vuetify` key:

```json
// locales/en.js
{
  "app": {
    "title": "My Application",
    "welcome": "Welcome"
  },
  
  "$vuetify": {
    "badge": "Badge",
    "open": "Open",
    "close": "Close",
    "confirmEdit": {
      "ok": "OK",
      "cancel": "Cancel"
    },
    "dataIterator": {
      "noResultsText": "No matching records found",
      "loadingText": "Loading items..."
    },
    "dataTable": {
      "itemsPerPageText": "Rows per page:",
      "ariaLabel": {
        "sortDescending": "Sorted descending.",
        "sortAscending": "Sorted ascending.",
        "sortNone": "Not sorted.",
        "activateNone": "Activate to remove sorting.",
        "activateDescending": "Activate to sort descending.",
        "activateAscending": "Activate to sort ascending."
      },
      "sortBy": "Sort by"
    },
    "dataFooter": {
      "itemsPerPageText": "Items per page:",
      "itemsPerPageAll": "All",
      "nextPage": "Next page",
      "prevPage": "Previous page",
      "firstPage": "First page",
      "lastPage": "Last page",
      "pageText": "{0}-{1} of {2}"
    },
    "dateRangeInput": {
      "divider": "to"
    },
    "datePicker": {
      "itemsSelected": "{0} selected",
      "range": {
        "title": "Select dates",
        "header": "Enter dates"
      },
      "title": "Select date",
      "header": "Enter date",
      "input": {
        "placeholder": "Enter date"
      }
    },
    "noDataText": "No data available",
    "carousel": {
      "prev": "Previous visual",
      "next": "Next visual",
      "ariaLabel": {
        "delimiter": "Carousel slide {0} of {1}"
      }
    },
    "calendar": {
      "moreEvents": "{0} more",
      "today": "Today"
    },
    "input": {
      "clear": "Clear {0}",
      "prependAction": "{0} prepended action",
      "appendAction": "{0} appended action",
      "otp": "Please enter OTP character {0}"
    },
    "fileInput": {
      "counter": "{0} files",
      "counterSize": "{0} files ({1} in total)"
    },
    "timePicker": {
      "am": "AM",
      "pm": "PM",
      "title": "Select Time"
    },
    "pagination": {
      "ariaLabel": {
        "root": "Pagination Navigation",
        "next": "Next page",
        "previous": "Previous page",
        "page": "Go to page {0}",
        "currentPage": "Page {0}, Current page",
        "first": "First page",
        "last": "Last page"
      }
    },
    "stepper": {
      "next": "Next",
      "prev": "Previous"
    },
    "rating": {
      "ariaLabel": {
        "item": "Rating {0} of {1}"
      }
    },
    "loading": "Loading...",
    "infiniteScroll": {
      "loadMore": "Load more",
      "empty": "No more"
    }
  }
}
```

### Khmer (Cambodian) Example

```json
// locales/km.json
{
  "app": {
    "title": "កម្មវិធីរបស់ខ្ញុំ",
    "welcome": "សូមស្វាគមន៍"
  },
  
  "$vuetify": {
    "badge": "ផ្លាកសញ្ញា",
    "open": "បើក",
    "close": "បិទ",
    "confirmEdit": {
      "ok": "យល់ព្រម",
      "cancel": "បោះបង់"
    },
    "dataIterator": {
      "noResultsText": "រកមិនឃើញទិន្នន័យ",
      "loadingText": "កំពុងផ្ទុក..."
    },
    "dataTable": {
      "itemsPerPageText": "ជួរក្នុងមួយទំព័រ:",
      "ariaLabel": {
        "sortDescending": "តម្រៀបចុះ។",
        "sortAscending": "តម្រៀបឡើង។",
        "sortNone": "មិនតម្រៀប។"
      },
      "sortBy": "តម្រៀបតាម"
    },
    "dataFooter": {
      "itemsPerPageText": "ធាតុក្នុងមួយទំព័រ:",
      "itemsPerPageAll": "ទាំងអស់",
      "nextPage": "ទំព័របន្ទាប់",
      "prevPage": "ទំព័រមុន",
      "firstPage": "ទំព័រដំបូង",
      "lastPage": "ទំព័រចុងក្រោយ",
      "pageText": "{0}-{1} នៃ {2}"
    },
    "noDataText": "គ្មានទិន្នន័យ",
    "loading": "កំពុងផ្ទុក...",
    "pagination": {
      "ariaLabel": {
        "root": "រុករកទំព័រ",
        "next": "ទំព័របន្ទាប់",
        "previous": "ទំព័រមុន",
        "page": "ទៅទំព័រ {0}",
        "currentPage": "ទំព័រ {0}, ទំព័របច្ចុប្បន្ន"
      }
    }
  }
}
```

### Arabic (RTL) Example

```json
// locales/ar.json
{
  "app": {
    "title": "تطبيقي",
    "welcome": "مرحبا"
  },
  
  "$vuetify": {
    "badge": "شارة",
    "open": "فتح",
    "close": "إغلاق",
    "dataIterator": {
      "noResultsText": "لم يتم العثور على نتائج",
      "loadingText": "جاري التحميل..."
    },
    "dataTable": {
      "itemsPerPageText": "الصفوف لكل صفحة:",
      "sortBy": "ترتيب حسب"
    },
    "dataFooter": {
      "itemsPerPageText": "العناصر لكل صفحة:",
      "itemsPerPageAll": "الكل",
      "nextPage": "الصفحة التالية",
      "prevPage": "الصفحة السابقة",
      "firstPage": "الصفحة الأولى",
      "lastPage": "الصفحة الأخيرة",
      "pageText": "{0}-{1} من {2}"
    },
    "noDataText": "لا توجد بيانات",
    "loading": "جاري التحميل...",
    "pagination": {
      "ariaLabel": {
        "root": "التنقل بين الصفحات",
        "next": "الصفحة التالية",
        "previous": "الصفحة السابقة",
        "page": "انتقل إلى الصفحة {0}",
        "currentPage": "الصفحة {0}، الصفحة الحالية"
      }
    }
  }
}
```

---

## Usage

### Switching Locales

```vue
<script setup lang="ts">
const { locale, locales, setLocale } = useI18n()
const { t } = useI18n()

const availableLocales = computed(() => 
  locales.value.filter(i => i.code !== locale.value)
)

const switchLocale = async (code: string) => {
  await setLocale(code)
  // Vuetify locale updates automatically
}
</script>

<template>
  <v-app>
    <v-app-bar>
      <v-app-bar-title>{{ t('app.title') }}</v-app-bar-title>
      
      <v-spacer />
      
      <v-menu>
        <template #activator="{ props }">
          <v-btn v-bind="props" icon="mdi-translate" />
        </template>
        <v-list>
          <v-list-item
            v-for="loc in availableLocales"
            :key="loc.code"
            @click="switchLocale(loc.code)"
          >
            <v-list-item-title>{{ loc.name }}</v-list-item-title>
          </v-list-item>
        </v-list>
      </v-menu>
    </v-app-bar>
    
    <v-main>
      <!-- Vuetify components automatically use translated strings -->
      <v-data-table :items="[]" />
      <!-- Shows "No data available" or translated equivalent -->
    </v-main>
  </v-app>
</template>
```

### Using Vuetify Locale Composable

```vue
<script setup lang="ts">
const { current, t } = useLocale()

// Get current Vuetify locale
console.log(current.value)  // 'en'

// Translate Vuetify strings
const closeText = t('close')  // 'Close'
</script>
```

### Language Selector Component

```vue
<!-- components/LanguageSelector.vue -->
<script setup lang="ts">
const { locale, locales, setLocale } = useI18n()

const currentLocale = computed(() => 
  locales.value.find(l => l.code === locale.value)
)
</script>

<template>
  <v-menu>
    <template #activator="{ props }">
      <v-btn v-bind="props" variant="text">
        <v-icon start>mdi-translate</v-icon>
        {{ currentLocale?.name }}
        <v-icon end>mdi-menu-down</v-icon>
      </v-btn>
    </template>
    
    <v-list density="compact">
      <v-list-item
        v-for="loc in locales"
        :key="loc.code"
        :active="loc.code === locale"
        @click="setLocale(loc.code)"
      >
        <v-list-item-title>{{ loc.name }}</v-list-item-title>
      </v-list-item>
    </v-list>
  </v-menu>
</template>
```

---

## RTL Support

### Configuration

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  i18n: {
    locales: [
      { code: 'en', file: 'en.js', dir: 'ltr' },
      { code: 'ar', file: 'ar.json', dir: 'rtl' },
      { code: 'he', file: 'he.json', dir: 'rtl' },
    ],
    defaultLocale: 'en',
  },

  vuetify: {
    vuetifyOptions: {
      locale: {
        rtl: {
          ar: true,
          he: true,
          fa: true,
          ur: true,
        }
      }
    }
  }
})
```

### Automatic RTL Switching

When switching to an RTL locale, Vuetify automatically:
- Mirrors the layout
- Flips icons where appropriate
- Adjusts padding/margins

```vue
<script setup lang="ts">
const { isRtl } = useRtl()

// Check if current locale is RTL
console.log(isRtl.value)
</script>

<template>
  <v-app :rtl="isRtl">
    <!-- Content automatically mirrors for RTL -->
  </v-app>
</template>
```

### Manual RTL Toggle

```vue
<script setup lang="ts">
const { isRtl } = useRtl()
const vuetify = useVuetify()

const toggleRtl = () => {
  vuetify.locale.isRtl = !vuetify.locale.isRtl
}
</script>
```

---

## Advanced Configuration

### Lazy Loading Locales

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  i18n: {
    lazy: true,
    locales: [
      { code: 'en', file: 'en.js' },
      { code: 'km', file: 'km.json' },
    ],
    langDir: 'locales/',
  },
})
```

### Per-Component Locale

```vue
<script setup lang="ts">
// Use specific locale for this component
const { t } = useI18n({
  useScope: 'local',
  messages: {
    en: { greeting: 'Hello' },
    km: { greeting: 'សួស្តី' },
  }
})
</script>
```

### Date Localization

```typescript
// With date-fns adapter
vuetify: {
  vuetifyOptions: {
    dateAdapter: 'date-fns',
  }
}
```

```vue
<script setup lang="ts">
const { current } = useLocale()
const date = useDate()

// Format date according to current locale
const formattedDate = date.format(new Date(), 'fullDateWithWeekday')
</script>
```

### Disable i18n Integration

```typescript
vuetify: {
  i18n: false,  // Use Vuetify's built-in locale system
  
  vuetifyOptions: {
    locale: {
      locale: 'en',
      fallback: 'en',
      messages: {
        en: { /* ... */ },
        km: { /* ... */ },
      }
    }
  }
}
```

---

## Troubleshooting

### Vuetify Not Using Translations

**Problem:** Vuetify shows English text despite switching locale.

**Solutions:**

1. Check module order:
```typescript
modules: [
  '@nuxtjs/i18n',        // Must be first
  'vuetify-nuxt4-module',
]
```

2. Verify `$vuetify` key exists in locale files:
```json
{
  "$vuetify": {
    "close": "Close"
  }
}
```

3. Check i18n integration is enabled:
```typescript
vuetify: {
  i18n: true,
}
```

### RTL Not Working

**Problem:** Layout doesn't mirror for RTL locales.

**Solutions:**

1. Configure RTL in Vuetify:
```typescript
vuetify: {
  vuetifyOptions: {
    locale: {
      rtl: {
        ar: true,
      }
    }
  }
}
```

2. Add `dir` to i18n locale config:
```typescript
i18n: {
  locales: [
    { code: 'ar', file: 'ar.json', dir: 'rtl' },
  ]
}
```

### Hydration Mismatch with Locale

**Problem:** Server and client render different locales.

**Solution:** Use `detectBrowserLanguage` carefully:

```typescript
i18n: {
  detectBrowserLanguage: {
    useCookie: true,
    cookieKey: 'i18n_redirected',
    redirectOn: 'root',
  }
}
```

### Missing Translations

**Problem:** Some Vuetify strings not translated.

**Solution:** Check Vuetify's source for all required keys:
- [Vuetify English locale](https://github.com/vuetifyjs/vuetify/blob/master/packages/vuetify/src/locale/en.ts)

---

## Complete Example

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: [
    '@nuxtjs/i18n',
    'vuetify-nuxt4-module',
  ],

  i18n: {
    locales: [
      { code: 'en', file: 'en.js', name: 'English', dir: 'ltr' },
      { code: 'km', file: 'km.json', name: 'ខ្មែរ', dir: 'ltr' },
      { code: 'ar', file: 'ar.json', name: 'العربية', dir: 'rtl' },
    ],
    defaultLocale: 'en',
    langDir: 'locales/',
    lazy: true,
    strategy: 'prefix_except_default',
    detectBrowserLanguage: {
      useCookie: true,
      cookieKey: 'i18n_locale',
      redirectOn: 'root',
    },
  },

  vuetify: {
    i18n: true,
    vuetifyOptions: {
      locale: {
        rtl: {
          ar: true,
        }
      }
    }
  }
})
```

```vue
<!-- app.vue -->
<script setup lang="ts">
const { locale, locales, setLocale } = useI18n()
const { isRtl } = useRtl()
</script>

<template>
  <v-app>
    <v-app-bar>
      <v-app-bar-title>{{ $t('app.title') }}</v-app-bar-title>
      
      <v-spacer />
      
      <v-btn-toggle v-model="locale" mandatory>
        <v-btn
          v-for="loc in locales"
          :key="loc.code"
          :value="loc.code"
          size="small"
          @click="setLocale(loc.code)"
        >
          {{ loc.code.toUpperCase() }}
        </v-btn>
      </v-btn-toggle>
    </v-app-bar>
    
    <v-main>
      <v-container>
        <v-data-table
          :headers="[
            { title: $t('table.name'), key: 'name' },
            { title: $t('table.email'), key: 'email' },
          ]"
          :items="[]"
        />
      </v-container>
    </v-main>
  </v-app>
</template>
```
